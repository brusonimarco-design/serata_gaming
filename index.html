<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Serata Gaming</title>

<style>
body {
  font-family: Arial, sans-serif;
  background:#1a1a1a;
  color:#f0f0f0;
  text-align:center;
  margin:0;
}

h1 {
  background:#282828;
  margin:0;
  padding:25px;
}

.container {
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:20px;
  padding:40px;
}

.gamer-card {
  background:#333;
  width:250px;
  border-radius:15px;
  padding:20px;
  box-shadow:0 4px 10px rgba(0,0,0,.5);
  transition:.3s;
}

.gamer-card.voted-yes {
  border:3px solid #28a745;
  box-shadow:0 0 15px #28a745;
}

.gamer-card.voted-no {
  border:3px solid #dc3545;
  box-shadow:0 0 15px #dc3545;
}

.gamer-photo {
  width:140px;
  height:140px;
  border-radius:50%;
  border:3px solid #ffd700;
  object-fit:cover;
}

h2 { color:#ffd700; }

.button-group {
  display:flex;
  gap:10px;
  justify-content:center;
  margin-top:15px;
}

button {
  border:none;
  border-radius:8px;
  padding:10px;
  cursor:pointer;
  font-size:.8em;
}

.yes { background:#28a745; color:white; }
.no  { background:#dc3545; color:white; }

button:disabled {
  opacity:.5;
  cursor:not-allowed;
}

#vote-totals {
  font-size:1.4em;
  margin-bottom:40px;
}

#music-controls {
  margin: 20px;
}
</style>
</head>

<script>
const SITE_PASSWORDS = ["cheeselamerda"]; 
if (!sessionStorage.getItem("authenticated")) {
  const pwd = prompt("Inserisci la password per accedere al sito");
  if (SITE_PASSWORDS.includes(pwd)) {
    sessionStorage.setItem("authenticated", "yes");
  } else {
    alert("Password errata! Non puoi accedere.");
    document.body.innerHTML = "<h1>Accesso negato</h1>";
  }
}
</script>

<body>

<!-- ===== Sottofondo musicale ===== -->
<audio id="bg-music" src="musica.mp3" loop></audio>
<div id="music-controls">
  <button id="toggle-music">‚ñ∂Ô∏è Play Musica</button>
</div>

<h1>üéÆ SERATA GAMING üéÆ</h1>
<p style="font-size:2em">Ultimo weekend di Febbraio</p>

<div class="container">

  <div class="gamer-card" data-name="STEVEN">
    <h2>STEVEN</h2>
    <img src="ste.png" class="gamer-photo">
    <div class="button-group">
      <button class="yes" onclick="vote('STEVEN','SI')">‚úÖ Ci sono</button>
      <button class="no" onclick="vote('STEVEN','NO')">‚ùå Non ci sono</button>
    </div>
  </div>

  <div class="gamer-card" data-name="ED-O">
    <h2>ED-O</h2>
    <img src="edo.png" class="gamer-photo">
    <div class="button-group">
      <button class="yes" onclick="vote('ED-O','SI')">‚úÖ Ci sono</button>
      <button class="no" onclick="vote('ED-O','NO')">‚ùå Non ci sono</button>
    </div>
  </div>

  <div class="gamer-card" data-name="CONRAD">
    <h2>CONRAD</h2>
    <img src="corrad.png" class="gamer-photo">
    <div class="button-group">
      <button class="yes" onclick="vote('CONRAD','SI')">‚úÖ Ci sono</button>
      <button class="no" onclick="vote('CONRAD','NO')">‚ùå Non ci sono</button>
    </div>
  </div>

  <div class="gamer-card" data-name="MARK">
    <h2>MARK</h2>
    <img src="marco.png" class="gamer-photo">
    <div class="button-group">
      <button class="yes" onclick="vote('MARK','SI')">‚úÖ Ci sono</button>
      <button class="no" onclick="vote('MARK','NO')">‚ùå Non ci sono</button>
    </div>
  </div>

</div>

<div id="vote-totals">‚úÖ Si: 0 | ‚ùå No: 0</div>

<!-- ===== Pulsante per azzerare i voti ===== -->
<button onclick="resetVotes()">üîÑ Reset Voti</button>

<script>
const EVENT_ID = "gaming_ultimo_we_febbraio";

const sheetURL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vRwvtUgBOmxF-uMf_hL7KL3PwTEMXFisukdRjhbRqR0pOZBOQea0Xgy_dRdpFDQOFmRE8uetmbfUgpO/pub?output=csv";

const passwords = {
  "STEVEN":"pass123",
  "ED-O":"edo456",
  "CONRAD":"corrad789",
  "MARK":"mark321"
};

const voteLinks = {
  "STEVEN": { SI:"https://docs.google.com/forms/d/e/1FAIpQLSd-xFPzzA0_D3byiTuvkPi82IAzyVBrY3fQiNGkfvXrZU0VNw/viewform?usp=pp_url&entry.958723597=STEVEN&entry.86624913=SI", NO:"https://docs.google.com/forms/d/e/1FAIpQLSd-xFPzzA0_D3byiTuvkPi82IAzyVBrY3fQiNGkfvXrZU0VNw/viewform?usp=pp_url&entry.958723597=STEVEN&entry.86624913=NO" },
  "ED-O":   { SI:"https://docs.google.com/forms/d/e/1FAIpQLSd-xFPzzA0_D3byiTuvkPi82IAzyVBrY3fQiNGkfvXrZU0VNw/viewform?usp=pp_url&entry.958723597=ED-O&entry.86624913=SI", NO:"https://docs.google.com/forms/d/e/1FAIpQLSd-xFPzzA0_D3byiTuvkPi82IAzyVBrY3fQiNGkfvXrZU0VNw/viewform?usp=pp_url&entry.958723597=ED-O&entry.86624913=NO" },
  "CONRAD": { SI:"https://docs.google.com/forms/d/e/1FAIpQLSd-xFPzzA0_D3byiTuvkPi82IAzyVBrY3fQiNGkfvXrZU0VNw/viewform?usp=pp_url&entry.958723597=CONRAD&entry.86624913=SI", NO:"https://docs.google.com/forms/d/e/1FAIpQLSd-xFPzzA0_D3byiTuvkPi82IAzyVBrY3fQiNGkfvXrZU0VNw/viewform?usp=pp_url&entry.958723597=CONRAD&entry.86624913=NO" },
  "MARK":   { SI:"https://docs.google.com/forms/d/e/1FAIpQLSd-xFPzzA0_D3byiTuvkPi82IAzyVBrY3fQiNGkfvXrZU0VNw/viewform?usp=pp_url&entry.958723597=MARK&entry.86624913=SI", NO:"https://docs.google.com/forms/d/e/1FAIpQLSd-xFPzzA0_D3byiTuvkPi82IAzyVBrY3fQiNGkfvXrZU0VNw/viewform?usp=pp_url&entry.958723597=MARK&entry.86624913=NO" }
};

function updateTotals() {
  let yes = 0, no = 0;
  document.querySelectorAll(".gamer-card").forEach(card => {
    if (card.classList.contains("voted-yes")) yes++;
    if (card.classList.contains("voted-no")) no++;
  });
  document.getElementById("vote-totals").innerText = `‚úÖ Si: ${yes} | ‚ùå No: ${no}`;
}

function vote(name, choice) {
  if (localStorage.getItem(EVENT_ID + "_voted_" + name)) {
    alert("Hai gi√† votato!");
    return;
  }

  const pwd = prompt(`Password di ${name}`);
  if (pwd !== passwords[name]) {
    alert("Password errata");
    return;
  }

  localStorage.setItem(EVENT_ID + "_voted_" + name, choice);
  const card = document.querySelector(`.gamer-card[data-name="${name}"]`);
  card.classList.add(choice === "SI" ? "voted-yes" : "voted-no");
  card.querySelectorAll("button").forEach(b => b.disabled = true);

  updateTotals();  // Aggiorna i totali subito

  window.open(voteLinks[name][choice], "_blank");
}

/* ===== CSV PARSER ===== */
function parseCSV(text) {
  return text.split("\n").slice(1).map(r =>
    r.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g)
      ?.map(x => x.replace(/"/g,""))
  ).filter(Boolean);
}

async function loadVotes() {
  const res = await fetch(sheetURL);
  const csv = await res.text();
  const rows = parseCSV(csv);

  const counted = {};

  rows.forEach(c => {
    const name = c[1];
    const vote = c[2];
    if (!name || counted[name]) return;
    counted[name] = true;

    const card = document.querySelector(`.gamer-card[data-name="${name}"]`);
    if (!card) return;

    card.querySelectorAll("button").forEach(b => b.disabled = true);

    if (vote === "SI") {
      card.classList.add("voted-yes");
    } else {
      card.classList.add("voted-no");
    }
  });

  updateTotals();
}

// ===== Carica voti locali da localStorage =====
function loadLocalVotes() {
  document.querySelectorAll(".gamer-card").forEach(card => {
    const name = card.dataset.name;
    const choice = localStorage.getItem(EVENT_ID + "_voted_" + name);
    if (choice) {
      card.classList.add(choice === "SI" ? "voted-yes" : "voted-no");
      card.querySelectorAll("button").forEach(b => b.disabled = true);
    }
  });
  updateTotals();
}

// ===== Funzione per resettare i voti con password =====
function resetVotes() {
  const pwd = prompt("Inserisci la password di reset");
  if (pwd === "reset123") { // cambia la password come vuoi
    localStorage.removeItem(EVENT_ID + "_voted_STEVEN");
    localStorage.removeItem(EVENT_ID + "_voted_ED-O");
    localStorage.removeItem(EVENT_ID + "_voted_CONRAD");
    localStorage.removeItem(EVENT_ID + "_voted_MARK");

    document.querySelectorAll(".gamer-card").forEach(card => {
      card.classList.remove("voted-yes", "voted-no");
      card.querySelectorAll("button").forEach(b => b.disabled = false);
    });

    updateTotals();
    alert("Voti azzerati!");
  } else {
    alert("Password errata!");
  }
}

// ===== Funzione per Play/Pause Musica =====
const music = document.getElementById("bg-music");
const musicBtn = document.getElementById("toggle-music");
musicBtn.addEventListener("click", () => {
  if (music.paused) {
    music.play();
    musicBtn.innerText = "‚è∏Ô∏è Pausa Musica";
  } else {
    music.pause();
    musicBtn.innerText = "‚ñ∂Ô∏è Play Musica";
  }
});

loadLocalVotes();
loadVotes();
setInterval(loadVotes, 5000);
</script>

</body>
</html>
